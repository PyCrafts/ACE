



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for Analysis Correlation Engine">
      
      
      
        <meta name="author" content="John Davison">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-4.6.3">
    
    
      
        <title>Engine - Analysis Correlation Engine</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#engine" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Analysis Correlation Engine" aria-label="Analysis Correlation Engine" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Analysis Correlation Engine
            </span>
            <span class="md-header-nav__topic">
              
                Engine
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" class="md-tabs__link md-tabs__link--active">
          Design
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../installation/" class="md-tabs__link">
          Installation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../user/" class="md-tabs__link">
          Analyst Guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../admin/" class="md-tabs__link">
          Administrators Guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../development/" class="md-tabs__link">
          Development Guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../database/" class="md-tabs__link">
          Databases
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Analysis Correlation Engine" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Analysis Correlation Engine
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Design
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Design
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Philosophy" class="md-nav__link">
      Philosophy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../analysis_overview/" title="Analysis Overview" class="md-nav__link">
      Analysis Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../collector/" title="Collectors" class="md-nav__link">
      Collectors
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Engine
      </label>
    
    <a href="./" title="Engine" class="md-nav__link md-nav__link--active">
      Engine
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#workloads" class="md-nav__link">
    Workloads
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worker-processes" class="md-nav__link">
    Worker Processes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-pools" class="md-nav__link">
    Analysis Pools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expiring-worker-processes" class="md-nav__link">
    Expiring Worker Processes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#targeting-specific-analysis-modes" class="md-nav__link">
    Targeting Specific Analysis Modes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-failure" class="md-nav__link">
    Analysis Failure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#work-directory" class="md-nav__link">
    Work Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alert-disposition-monitoring" class="md-nav__link">
    Alert Disposition Monitoring
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../analysis_module/" title="Analysis Modules" class="md-nav__link">
      Analysis Modules
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Analyst Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Analyst Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user/hunting/" title="Hunting" class="md-nav__link">
      Hunting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Administrators Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Administrators Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Development Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Development Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/history/" title="History" class="md-nav__link">
      History
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Databases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Databases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#workloads" class="md-nav__link">
    Workloads
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worker-processes" class="md-nav__link">
    Worker Processes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-pools" class="md-nav__link">
    Analysis Pools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expiring-worker-processes" class="md-nav__link">
    Expiring Worker Processes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#targeting-specific-analysis-modes" class="md-nav__link">
    Targeting Specific Analysis Modes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-failure" class="md-nav__link">
    Analysis Failure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#work-directory" class="md-nav__link">
    Work Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alert-disposition-monitoring" class="md-nav__link">
    Alert Disposition Monitoring
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="engine">Engine<a class="headerlink" href="#engine" title="Permanent link">&para;</a></h1>
<p>An <em>engine</em> is a <a href="../service/">service</a> that loads one or more <a href="../analysis_module/">analysis modules</a> and analyzes <a href="../observable/">observables</a> generating <a href="../analysis/">analysis</a>. One or more engines can make up a <a href="../engine_cluster/">cluster</a>.</p>
<p>An engine by itself is referred to as a <strong>node</strong>.</p>
<p>Engines register themselves as <strong>nodes</strong> in the <code>nodes</code> table of the <a href="../../database/#database-ace">ace database</a>.</p>
<h2 id="workloads">Workloads<a class="headerlink" href="#workloads" title="Permanent link">&para;</a></h2>
<p>An engine pulls work from the <strong>workload</strong>. The workload is contained in the <code>workload</code> table in the <a href="../../database/#database-ace">ace database</a>. Work that is assigned to an engine creates a new entry inside the table. Workload items are then pulled by the workers running in the engine.</p>
<p>A single workload is shared across engine nodes running in a <a href="../engine_cluster/">cluster</a>.</p>
<h2 id="worker-processes">Worker Processes<a class="headerlink" href="#worker-processes" title="Permanent link">&para;</a></h2>
<p>An engine has one or more worker processes. These processes are what does most of the analysis work an engine does. Viewing the process hierarchy of a running engine shows a parent with multiple child copies of itself.</p>
<p>Worker processes are members of an analysis pool.</p>
<h2 id="analysis-pools">Analysis Pools<a class="headerlink" href="#analysis-pools" title="Permanent link">&para;</a></h2>
<p>Workers are grouped together into pools. Each pool can optionally be assigned a <em>priority</em>. When the worker pulls the next workload item it first checks for work with an analysis module that matches the priority if one is set. If none are available (or if no priority is set) then it pulls the oldest workload item.</p>
<p>The number of analysis pools an engine uses is configurable. If these configuration options are not set (this is the default) then a default pool with a size equal to the number of CPU cores on the current system is created with no priority.</p>
<p>To define analysis pools add options under the <code>[service_engine]</code> section with the following format.</p>
<pre class="codehilite"><code class="language-ini">[service_engine]
analysis_pool_size_MODE = int</code></pre>


<p><code>MODE</code> is the priority <a href="../analysis_modes/">analysis mode</a> for the pool.</p>
<p>The integer value is the size of the pool.</p>
<p>See <a href="../engine_cluster/#workloads-and-clustering">workloads and clustering</a> to understand how work is managed in a clustered environment.</p>
<h2 id="expiring-worker-processes">Expiring Worker Processes<a class="headerlink" href="#expiring-worker-processes" title="Permanent link">&para;</a></h2>
<p>Due to chaotic nature of the analysis work being performed by ACE, at times it becomes useful to release a worker and create a new one to replace it even if nothing seems wrong. This limits the impact of any hidden run-away resource issues caused by using so many different third-party applications, some of which may be in an alpha project status.</p>
<p>The <code>auto_refresh_frequency</code> configuration option specifies how many seconds a worker is alive.</p>
<h2 id="targeting-specific-analysis-modes">Targeting Specific Analysis Modes<a class="headerlink" href="#targeting-specific-analysis-modes" title="Permanent link">&para;</a></h2>
<p>An engine node can be configured to only process work set to specific <a href="../analysis_modes/">analysis modes</a>. The <code>local_analysis_modes</code> option is a comma separated list of modes this node will <strong>only</strong> process. By default this value is empty, which allows the engine to process work in any mode.</p>
<p>You can also <em>exclude</em> analysis modes from processing by using the <code>excluded_analysis_modes</code> option. Note that you cannot use both <code>local_analysis_modes</code> and <code>excluded_analysis_modes</code> on the same node.</p>
<h2 id="analysis-failure">Analysis Failure<a class="headerlink" href="#analysis-failure" title="Permanent link">&para;</a></h2>
<p>Analysis always fails at some point. In ACE a failure is represented as <strong>an uncaught python exception</strong>. ACE logs useful debugging information when this occurs. This saved in the <code>error_reporting</code> directory inside the <a href="../data_dir/">data directory</a>. The location of the error reporting directory is set by the <code>error_reporting_dir</code> option in the <code>[global]</code> <a href="../configuration/">configuration</a> section.</p>
<p>An engine can optionally save the <a href="../alert_data/">current state of the entire analysis</a> as a sub directory inside of the error reporting directory by setting the <code>copy_analysis_on_error</code> boolean option in the <code>[service_engine]</code> <a href="../configuration/">configuration</a> section to <code>yes</code>.</p>
<h2 id="work-directory">Work Directory<a class="headerlink" href="#work-directory" title="Permanent link">&para;</a></h2>
<p>ACE stores <a href="../root_analysis/">root analysis</a> objects inside the <strong>work directory</strong>. By default ACE uses the <a href="../alert_storage/">data directory for alert storage</a>. You can change the work directory by setting the <code>work_dir</code> <a href="../configuration/">configuration</a> value in the <code>[service_engine]</code> section. This directory is relative to the <a href="../saq_home/">installation directory</a>.</p>
<p>You might use this option to mount a faster, smaller disk to use for very high volume analysis work, such as scanning email data.</p>
<p>When a <a href="../root_analysis/">root analysis</a> becomes an <a href="../alerts/">alert</a>, the data moves from the work directory to the <a href="../alert_storage/">alert storage directory</a>.</p>
<h2 id="alert-disposition-monitoring">Alert Disposition Monitoring<a class="headerlink" href="#alert-disposition-monitoring" title="Permanent link">&para;</a></h2>
<p>ACE stops analysis When an analyst <a href="link">dispositions</a> an <a href="../alerts/">alert</a>. This is useful when are large number of invalid alerts are submitted to the system by mistake, as it allows the system to recover without having to analyze the invalid submissions.</p>
<p>This can also lend itself to analysts thinking something isn't working correctly.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../collector/" title="Collectors" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Collectors
              </span>
            </div>
          </a>
        
        
          <a href="../analysis_module/" title="Analysis Modules" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Analysis Modules
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.df00da5d.js"></script>
      
      <script>app.initialize({version:"1.1.2",url:{base:"../.."}})</script>
      
    
  </body>
</html>